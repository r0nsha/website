---
import { getCollection } from "astro:content";
import Base from "../layouts/Base.astro";

const posts = await getCollection("posts");
const tags = new Map<string, number>();

for (const post of posts) {
    for (const tag of post.data.tags) {
        if (!tags.has(tag)) {
            tags.set(tag, 1);
        } else {
            tags.set(tag, tags.get(tag) + 1);
        }
    }
}

const sortedTags = [...tags].sort(([name1], [name2]) => {
    const nameA = name1.toLowerCase();
    const nameB = name2.toLowerCase();

    if (nameA < nameB) {
        return -1;
    } else if (nameA > nameB) {
        return 1;
    }

    return 0;
});
---

<Base title="Tags">
    <h1>Tags</h1>
    <ul>
        {
            sortedTags.map(([tag, count]) => (
                <li>
                    <a href={`/tags/${tag}`}>
                        #{tag} ({count})
                    </a>
                </li>
            ))
        }
    </ul>
</Base>

<style>
    ul {
        list-style: none;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 1rem;

        li {
            font-size: 1.15rem;
        }
    }
</style>
